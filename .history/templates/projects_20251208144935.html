<!-- templates/projects.html -->
{% extends "base.html" %}
{% block content %}
<h2>Projects</h2>
<p>List of government projects being tracked.</p>

<div class="projects-grid">
  {% for p in projects %}
  <div class="project-card" style="position: relative;">
    {% if session.get('admin_user') %}
    <button class="edit-btn" data-project-id="{{ p.id }}">✎ Edit</button>
    {% endif %}
    <h3><a href="{{ url_for('project_detail', pid=p.id) }}">{{ p.name }}</a></h3>
    <p class="muted">{{ p.project_sector }} — {{ p.region or 'N/A' }}</p>
    <p>{{ p.description or '-' }}</p>
    <div class="project-meta">
      <div>Allocated: ₱{{ "{:,.2f}".format(p.allocated_budget or 0) }}</div>
      <div>Spent: ₱{{ "{:,.2f}".format(p.spent or 0) }}</div>
      <div>Status: <strong>{{ p.status }}</strong></div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- Edit Project Modal -->
<div id="editModal" class="edit-modal-overlay" style="display: none;" onclick="closeEditModal(event)">
  <div class="edit-modal" onclick="event.stopPropagation()">
    <div class="edit-modal-header">
      <h2>Edit Project</h2>
      <button class="edit-modal-close" onclick="closeEditModal()">&times;</button>
    </div>
    <div class="edit-modal-body">
      <form id="editProjectForm" method="post">
        <div class="form-row">
          <div>
            <label>Project Name</label>
            <input name="name" type="text" required>
          </div>
          <div>
            <label>Project Sector</label>
            <select name="project_sector" required>
              <option value="">Select Project Sector</option>
              <option value="Road Infrastructure">Road Infrastructure</option>
              <option value="Bridge Infrastructure">Bridge Infrastructure</option>
              <option value="Flood Control and Drainage">Flood Control and Drainage</option>
              <option value="Public Buildings">Public Buildings</option>
              <option value="Water Resources and Irrigation">Water Resources and Irrigation</option>
              <option value="Special Infrastructure Projects">Special Infrastructure Projects</option>
              <option value="Disaster Response and Rehabilitation">Disaster Response and Rehabilitation</option>
              <option value="Local Infrastructure Support">Local Infrastructure Support</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div>
            <label>Region</label>
            <select name="region" id="regionSelect" required>
              <option value="">Select Region</option>
            </select>
          </div>
          <div>
            <label>Status</label>
            <select name="status">
              <option value="Planned">Planned</option>
              <option value="Ongoing">Ongoing</option>
              <option value="Completed">Completed</option>
            </select>
          </div>
        </div>

        <div class="form-row">
          <div>
            <label>Allocated Budget</label>
            <input name="allocated_budget" type="number" step="0.01" required>
          </div>
          <div>
            <label>Spent Amount</label>
            <input name="spent" type="number" step="0.01" required>
          </div>
        </div>

        <div style="margin-bottom: 0.6rem;">
          <label style="display: block; font-weight: 600; font-size: 0.95rem; color: #333; margin-bottom: 0.4rem;">Description</label>
          <textarea name="description" rows="4" style="width: 100%; padding: 0.6rem; border: 1px solid #ddd; border-radius: 6px; font-family: 'Inter', sans-serif; resize: vertical;"></textarea>
        </div>

        <div class="form-row" style="gap: 1rem; grid-template-columns: 1fr 1fr;">
          <button class="btn" type="submit">Save Changes</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  const allRegions = JSON.parse('{{ regions_list|tojson|safe }}');
</script>
<script src="{{ url_for('static', filename='edit_project.js') }}"></script>
{% endblock %}
