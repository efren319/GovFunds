<!-- templates/project_detail.html -->
{% extends "base.html" %}

{% block content %}
<h2>{{ project.project_name }}</h2>
<p class="muted">{{ project.sector_name or 'N/A' }} — {{ project.region_name or 'N/A' }}</p>
<p>{{ project.project_description }}</p>

<ul class="detail-list">
  <li>Allocated Budget: ₱{{ "{:,.2f}".format(project.allocated_budget or 0) }}</li>
  <li>Spent: ₱{{ "{:,.2f}".format(project.budget_spent or 0) }}</li>
  <li>Remaining: ₱{{ "{:,.2f}".format((project.allocated_budget or 0) - (project.budget_spent or 0)) }}</li>
  <li>Status: {{ project.project_status }}</li>
  <li>Start: {{ project.start_date or 'N/A' }}</li>
  <li>End: {{ project.end_date or 'N/A' }}</li>
</ul>

<!-- Report Submission Form -->
<div class="report-form-section">
  <h3>Submit a Report</h3>
  <p class="form-description">Have feedback or found an issue with this project? Let us know.</p>
  <form method="post" action="{{ url_for('feedback') }}" class="form report-form">
    <input type="hidden" name="feedback_type" value="report">
    <input type="hidden" name="project_id" value="{{ project.project_id }}">
    
    <div class="form-row">
      <input type="text" name="reporter_name" placeholder="Your name (optional)">
      <input type="email" name="reporter_email" placeholder="Your email (optional)">
    </div>
    
    <div class="form-row">
      <input type="text" name="report_subject" placeholder="Report subject" required>
      <select name="report_type" required>
        <option value="">Select report type</option>
        <option value="General">General Feedback</option>
        <option value="Issue">Issue/Problem</option>
        <option value="Concern">Concern</option>
        <option value="Suggestion">Suggestion</option>
      </select>
    </div>
    
    <div class="form-row">
      <textarea name="report_message" placeholder="Describe your report..." required></textarea>
    </div>
    
    <div class="form-row">
      <button type="submit" class="btn">Submit Report</button>
    </div>
  </form>
</div>

{% if reports %}
<h3>Project Reports ({{ reports|length }})</h3>
<div class="reports-section">
  {% for report in reports %}
  <div class="report-card {% if not report.is_resolved %}unresolved{% endif %}">
    <div class="report-header">
      <div>
        <h4>{{ report.report_subject }}</h4>
        <span class="report-type report-type-{{ (report.report_type or 'general')|lower }}">{{ report.report_type or 'General' }}</span>
      </div>
      {% if not report.is_resolved %}
      <span class="unresolved-badge">UNRESOLVED</span>
      {% else %}
      <span class="resolved-badge">RESOLVED</span>
      {% endif %}
    </div>
    <p class="report-message">{{ report.report_message }}</p>
    <div class="report-meta">
      <span class="report-reporter">{{ report.reporter_name or 'Anonymous' }}</span>
      <span class="report-date">{{ report.created_at.strftime('%Y-%m-%d %H:%M') if report.created_at else '' }}</span>
    </div>
  </div>
  {% endfor %}
</div>
{% endif %}
{% endblock %}
