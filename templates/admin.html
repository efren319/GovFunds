<!-- templates/admin.html -->
{% extends "base.html" %}
{% block content %}
<h2>Add Project</h2>
<form method="post" class="form admin-form">
  <input type="hidden" name="action" value="add_project">
  <div class="form-row">
    <input name="name" placeholder="Project name" required>
    <select name="project_sector" required>
      <option value="">Select Project Sector</option>
      <option value="Road Infrastructure">Road Infrastructure</option>
      <option value="Bridge Infrastructure">Bridge Infrastructure</option>
      <option value="Flood Control and Drainage">Flood Control and Drainage</option>
      <option value="Public Buildings">Public Buildings</option>
      <option value="Water Resources and Irrigation">Water Resources and Irrigation</option>
      <option value="Special Infrastructure Projects">Special Infrastructure Projects</option>
      <option value="Disaster Response and Rehabilitation">Disaster Response and Rehabilitation</option>
      <option value="Local Infrastructure Support">Local Infrastructure Support</option>
    </select>
  </div>
  <div class="form-row">
    <input name="allocated_budget" type="number" step="0.01" placeholder="Allocated budget">
    <input name="spent" type="number" step="0.01" placeholder="Spent">
  </div>
  <div class="form-row">
    <select name="region" required>
      <option value="">Select Region</option>
      {% for region in regions %}
      <option value="{{ region }}">{{ region }}</option>
      {% endfor %}
    </select>
    <select name="status">
      <option>Planned</option>
      <option>Ongoing</option>
      <option>Completed</option>
    </select>
  </div>
  <div class="form-row">
    <textarea name="description" placeholder="Description"></textarea>
  </div>
  <div class="form-row">
    <button class="btn" type="submit">Add Project</button>
  </div>
</form>

<!-- Unresolved Reports Section -->
{% if unresolved_reports and unresolved_reports|length > 0 %}
<h3>Unresolved Project Reports ({{ unresolved_reports|length }})</h3>
<div class="admin-reports-section">
  {% for report in unresolved_reports %}
  <div class="admin-report-card">
    <div class="admin-report-header">
      <div>
        <h4>{{ report['report_subject'] }}</h4>
        <p class="report-project">Project: <strong>{{ report['project_name'] }}</strong></p>
      </div>
      <span class="unresolved-badge">UNRESOLVED</span>
    </div>
    <p class="admin-report-type">Type: <strong>{{ report['report_type'] }}</strong></p>
    <p class="admin-report-message">{{ report['report_message'] }}</p>
    <div class="admin-report-meta">
      <span>From: {{ report['reporter_name'] or 'Anonymous' }}</span>
      <span>{{ report['created_at'] }}</span>
    </div>
    <form method="post" action="{{ url_for('resolve_report', report_id=report['id']) }}" style="margin-top: 1rem;">
      <button type="submit" class="resolve">Mark as Resolved</button>
    </form>
  </div>
  {% endfor %}
</div>
{% endif %}

<h3>Recent Projects</h3>
<table class="data-table">
  <thead><tr><th>ID</th><th>Name</th><th>Sector</th><th>Allocated</th><th>Spent</th><th>Status</th><th>Reports</th></tr></thead>
  <tbody>
    {% for p in projects %}
    <tr>
      <td>{{ p['id'] }}</td>
      <td>{{ p['name'] }}</td>
      <td>{{ p['project_sector'] }}</td>
      <td>â‚±{{ "{:,.2f}".format(p['allocated_budget'] or 0) }}</td>
      <td>â‚±{{ "{:,.2f}".format(p['spent'] or 0) }}</td>
      <td>{{ p['status'] }}</td>
      <td>
        {% if p['unresolved_reports'] and p['unresolved_reports'] > 0 %}
        <span class="report-badge" title="Unresolved reports">{{ p['unresolved_reports'] }} ðŸ”´</span>
        {% else %}
        <span class="report-badge-ok">0 âœ“</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
